{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "name": "enclii",
  "version": "1.0.0",
  "description": "Enclii PaaS - MADFAM Deployment Platform",
  "lastUpdated": "2026-01-21",

  "domains": {
    "production": {
      "api": "https://api.enclii.dev",
      "app": "https://app.enclii.dev",
      "admin": "https://admin.enclii.dev",
      "docs": "https://docs.enclii.dev",
      "landing": "https://enclii.dev"
    }
  },

  "ports": {
    "switchyardApi": 4200,
    "switchyardUi": 4201,
    "dispatch": 4203
  },

  "kubernetes": {
    "namespace": "enclii",
    "deployments": ["switchyard-api", "switchyard-ui", "dispatch"],
    "secrets": ["enclii-secrets", "dispatch-secrets"],
    "manifests": {
      "switchyardApi": "infra/k8s/production/switchyard-api-deployment.yaml",
      "switchyardUi": "infra/k8s/production/switchyard-ui-deployment.yaml",
      "dispatch": "apps/dispatch/k8s/deployment.yaml",
      "cloudflaredTunnel": "infra/k8s/production/cloudflared-unified.yaml"
    }
  },

  "entryPoints": {
    "switchyardApi": {
      "path": "apps/switchyard-api/cmd/api/main.go",
      "framework": "Go/Gin",
      "healthCheck": "/health"
    },
    "switchyardUi": {
      "path": "apps/switchyard-ui/app/page.tsx",
      "framework": "Next.js",
      "healthCheck": "/api/health"
    },
    "dispatch": {
      "path": "apps/dispatch/app/page.tsx",
      "framework": "Next.js",
      "healthCheck": "/api/health"
    }
  },

  "criticalConfiguration": {
    "cloudflaredTunnel": {
      "path": "infra/k8s/production/cloudflared-unified.yaml",
      "description": "Routes all external traffic through Cloudflare tunnel",
      "criticalLines": {
        "adminRouting": "72-76"
      }
    },
    "dispatchAuth": {
      "middleware": "apps/dispatch/middleware.ts",
      "authContext": "apps/dispatch/contexts/AuthContext.tsx",
      "envVars": ["ALLOWED_ADMIN_DOMAINS", "ALLOWED_ADMIN_ROLES"]
    }
  },

  "buildCommands": {
    "switchyardApi": "make build-api",
    "switchyardUi": "pnpm --filter switchyard-ui build",
    "dispatch": "pnpm --filter dispatch build",
    "all": "make build-all"
  },

  "testCommands": {
    "unit": "make test",
    "e2e": "make e2e",
    "lint": "make lint"
  },

  "dependencies": {
    "ecosystem": [
      {
        "name": "janua",
        "purpose": "Authentication",
        "config": "NEXT_PUBLIC_JANUA_URL=https://auth.madfam.io"
      }
    ],
    "external": ["PostgreSQL", "Redis", "Cloudflare"]
  },

  "dependents": []
}
