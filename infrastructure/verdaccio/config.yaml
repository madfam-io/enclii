# Verdaccio Configuration for npm.madfam.io
# Private npm registry for MADFAM ecosystem packages

storage: /verdaccio/storage
plugins: /verdaccio/plugins

# Web UI configuration
web:
  title: MADFAM Package Registry
  logo: https://madfam.io/logo.png
  primary_color: "#6366f1"
  favicon: https://madfam.io/favicon.ico

# Authentication
auth:
  htpasswd:
    file: /verdaccio/conf/htpasswd
    max_users: 100
    algorithm: bcrypt

# Security settings
security:
  api:
    legacy: true
    jwt:
      sign:
        expiresIn: 29d
      verify:
        maxAge: 30d
  web:
    sign:
      expiresIn: 7d

# Uplinks to public registries (for non-MADFAM packages)
uplinks:
  npmjs:
    url: https://registry.npmjs.org/
    timeout: 30s
    maxage: 10m
    fail_timeout: 5m
    max_fails: 3
    cache: true

# Package access rules
packages:
  # MADFAM scoped packages - private, authenticated only
  '@madfam/*':
    access: $authenticated
    publish: $authenticated
    unpublish: $authenticated
    # No proxy - these are our packages only

  '@janua/*':
    access: $authenticated
    publish: $authenticated
    unpublish: $authenticated

  '@cotiza/*':
    access: $authenticated
    publish: $authenticated
    unpublish: $authenticated

  '@fortuna/*':
    access: $authenticated
    publish: $authenticated
    unpublish: $authenticated

  '@avala/*':
    access: $authenticated
    publish: $authenticated
    unpublish: $authenticated

  '@forgesight/*':
    access: $authenticated
    publish: $authenticated
    unpublish: $authenticated

  '@coforma/*':
    access: $authenticated
    publish: $authenticated
    unpublish: $authenticated

  '@forj/*':
    access: $authenticated
    publish: $authenticated
    unpublish: $authenticated

  '@enclii/*':
    access: $authenticated
    publish: $authenticated
    unpublish: $authenticated

  # All other packages - proxy to npmjs
  '**':
    access: $all
    publish: $authenticated
    unpublish: $authenticated
    proxy: npmjs

# Server settings
server:
  keepAliveTimeout: 60

# Logging
logs:
  type: stdout
  format: pretty
  level: info

# Rate limiting
middlewares:
  audit:
    enabled: true

# Experiments (optional features)
experiments:
  changePassword: true
  search: true
