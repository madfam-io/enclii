# =============================================================================
# Dhanam Billing Secrets Template
# =============================================================================
# PURPOSE: Secure storage for payment provider credentials
# STRATEGY: Hybrid Router (Stripe MX + Paddle Global)
#
# INSTRUCTIONS:
# 1. Copy this file to secrets.yaml (NOT tracked in git)
# 2. Fill in the actual credentials from provider dashboards
# 3. Apply: kubectl apply -f secrets.yaml
# 4. Verify: kubectl get secret dhanam-secrets -n janua -o yaml
#
# SECURITY NOTES:
# - NEVER commit the filled secrets.yaml to git
# - Use sealed-secrets or external-secrets for production
# - Rotate credentials quarterly
# - All keys should be from LIVE mode for production
# =============================================================================

apiVersion: v1
kind: Secret
metadata:
  name: dhanam-secrets
  namespace: janua  # Will move to 'dhanam' namespace when service deploys
  labels:
    app: dhanam
    component: billing
    part-of: galaxy-ecosystem
  annotations:
    description: "Billing provider credentials for Dhanam payment processing"
    created-by: "operation-mint-treasury"
    strategy: "hybrid-router-stripe-paddle"
type: Opaque
stringData:
  # ===========================================================================
  # SEGMENT A: Mexico Market (Stripe Mexico)
  # ===========================================================================
  # Dashboard: https://dashboard.stripe.com/mx
  # Used for: Mexican customers, OXXO, SPEI, Visa/MC in MXN
  # Regulations: SAT compliance, RFC validation
  # ---------------------------------------------------------------------------

  # Publishable Key (safe for frontend)
  # Format: pk_live_... (51 chars)
  STRIPE_MX_PUBLISHABLE_KEY: "<pk_live_xxx>"

  # Secret Key (backend only - NEVER expose to frontend)
  # Format: sk_live_... (107 chars)
  STRIPE_MX_SECRET_KEY: "<sk_live_xxx>"

  # Webhook Secret (for verifying Stripe webhook signatures)
  # Format: whsec_... (32 chars)
  # Get from: Dashboard > Developers > Webhooks > Signing secret
  STRIPE_MX_WEBHOOK_SECRET: "<whsec_xxx>"

  # Stripe Account ID (optional, for Connect)
  # Format: acct_...
  # STRIPE_MX_ACCOUNT_ID: "<acct_xxx>"

  # ===========================================================================
  # SEGMENT B: Global Market (Paddle)
  # ===========================================================================
  # Dashboard: https://vendors.paddle.com
  # Used for: International customers, US/EU/LATAM (non-MX)
  # Benefits: Merchant of Record (handles VAT, sales tax, compliance)
  # ---------------------------------------------------------------------------

  # Vendor ID (numeric)
  # Get from: Dashboard > Developer Tools > Authentication
  PADDLE_VENDOR_ID: "<vendor_id>"

  # API Key (for server-side API calls)
  # Get from: Dashboard > Developer Tools > Authentication > Generate API Key
  PADDLE_API_KEY: "<paddle_api_key>"

  # Client-Side Token (for Paddle.js checkout)
  # Get from: Dashboard > Developer Tools > Authentication > Client-side token
  PADDLE_CLIENT_TOKEN: "<client_token>"

  # Webhook Secret (for verifying Paddle webhook signatures)
  # Get from: Dashboard > Developer Tools > Notifications > Webhook secret
  PADDLE_WEBHOOK_SECRET: "<webhook_secret>"

  # Paddle Environment (sandbox or live)
  PADDLE_ENVIRONMENT: "live"

  # ===========================================================================
  # SEGMENT C: Internal Configuration
  # ===========================================================================

  # Default currency by region
  BILLING_DEFAULT_CURRENCY_MX: "MXN"
  BILLING_DEFAULT_CURRENCY_GLOBAL: "USD"

  # Feature flags for payment methods
  BILLING_ENABLE_OXXO: "true"
  BILLING_ENABLE_SPEI: "true"
  BILLING_ENABLE_CARDS: "true"

  # Tax configuration
  BILLING_MX_VAT_RATE: "0.16"

  # Webhook endpoints (internal routing)
  # These will be set by the Dhanam service deployment
  # STRIPE_WEBHOOK_ENDPOINT: "https://api.janua.dev/webhooks/stripe"
  # PADDLE_WEBHOOK_ENDPOINT: "https://api.janua.dev/webhooks/paddle"

---
# =============================================================================
# NetworkPolicy: Restrict access to billing secrets
# =============================================================================
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: dhanam-secrets-access
  namespace: janua
spec:
  podSelector:
    matchLabels:
      app: dhanam
  policyTypes:
    - Ingress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app: janua-api
        - podSelector:
            matchLabels:
              app: dhanam
