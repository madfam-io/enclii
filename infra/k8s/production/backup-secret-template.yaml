# ==============================================================================
# Longhorn Backup Secret Template - Operation IRONCLAD
# ==============================================================================
#
# INSTRUCTIONS:
# 1. Replace all REPLACE_ME values with your actual S3/R2 credentials
# 2. Apply this secret: kubectl apply -f backup-secret-template.yaml
# 3. Then configure Longhorn backup target (see Phase 2 commands below)
#
# For Cloudflare R2:
#   - Create an R2 bucket in Cloudflare dashboard
#   - Create an API token with R2 read/write permissions
#   - Get your Account ID from the Cloudflare dashboard URL
#   - Endpoint format: https://<ACCOUNT_ID>.r2.cloudflarestorage.com
#
# For AWS S3:
#   - Create an S3 bucket with appropriate IAM permissions
#   - Create an IAM user with S3 access
#   - Endpoint: https://s3.<REGION>.amazonaws.com (or leave empty for default)
#
# ==============================================================================

apiVersion: v1
kind: Secret
metadata:
  name: longhorn-backup-secret
  namespace: longhorn-system
  labels:
    app.kubernetes.io/name: longhorn
    app.kubernetes.io/component: backup
type: Opaque
stringData:
  # AWS/R2 Access Key ID
  AWS_ACCESS_KEY_ID: "REPLACE_ME"

  # AWS/R2 Secret Access Key
  AWS_SECRET_ACCESS_KEY: "REPLACE_ME"

  # S3-compatible endpoint (required for R2, optional for AWS S3)
  # Cloudflare R2: https://<ACCOUNT_ID>.r2.cloudflarestorage.com
  # AWS S3: https://s3.<REGION>.amazonaws.com (or leave empty)
  AWS_ENDPOINTS: "https://REPLACE_ME.r2.cloudflarestorage.com"

---
# ==============================================================================
# PHASE 2 COMMANDS (Run after applying the secret above)
# ==============================================================================
#
# For Cloudflare R2 (replace BUCKET_NAME):
#   kubectl -n longhorn-system patch setting backup-target \
#     --type=merge -p '{"value": "s3://BUCKET_NAME@us-east-1/"}'
#
# For AWS S3 (replace BUCKET_NAME and REGION):
#   kubectl -n longhorn-system patch setting backup-target \
#     --type=merge -p '{"value": "s3://BUCKET_NAME@REGION/"}'
#
# Then link the secret:
#   kubectl -n longhorn-system patch setting backup-target-credential-secret \
#     --type=merge -p '{"value": "longhorn-backup-secret"}'
#
# ==============================================================================
