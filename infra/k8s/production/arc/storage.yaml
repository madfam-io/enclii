# Persistent storage for ARC build caching
# These PVCs provide shared caching across runner pods for faster builds
---
# Go module cache - shared across all runners
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: arc-go-cache
  namespace: arc-runners
  labels:
    app.kubernetes.io/name: arc
    app.kubernetes.io/component: cache
    arc.enclii.dev/cache-type: go
spec:
  accessModes:
    - ReadWriteOnce  # Local-path only supports RWO
  resources:
    requests:
      storage: 20Gi
  storageClassName: local-path  # K3s default storage class
---
# npm cache - shared across all runners
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: arc-npm-cache
  namespace: arc-runners
  labels:
    app.kubernetes.io/name: arc
    app.kubernetes.io/component: cache
    arc.enclii.dev/cache-type: npm
spec:
  accessModes:
    - ReadWriteOnce  # Local-path only supports RWO
  resources:
    requests:
      storage: 20Gi
  storageClassName: local-path
---
# Docker cache for Blue scale set
# Isolated per color to allow clean Docker layer cache during updates
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: arc-docker-cache-blue
  namespace: arc-runners
  labels:
    app.kubernetes.io/name: arc
    app.kubernetes.io/component: cache
    arc.enclii.dev/cache-type: docker
    arc.enclii.dev/color: blue
spec:
  accessModes:
    - ReadWriteOnce  # Docker daemon needs exclusive access
  resources:
    requests:
      storage: 50Gi
  storageClassName: local-path
---
# Docker cache for Green scale set
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: arc-docker-cache-green
  namespace: arc-runners
  labels:
    app.kubernetes.io/name: arc
    app.kubernetes.io/component: cache
    arc.enclii.dev/cache-type: docker
    arc.enclii.dev/color: green
spec:
  accessModes:
    - ReadWriteOnce  # Docker daemon needs exclusive access
  resources:
    requests:
      storage: 50Gi
  storageClassName: local-path
